import{d as $,a as C,u as D,r,e as P,v as S,f as U,m as G,j as a}from"./index-C5i556Ey.js";function L(){var j,h,N;const{id:l}=$(),v=C(),{t:e}=D("pages"),s=r.useMemo(()=>P.find(i=>i.id===parseInt(l)),[l]),g=localStorage.getItem("avatar"),m=localStorage.getItem("nombre"),x=localStorage.getItem("accesoQR"),t=r.useRef(null),[n,p]=r.useState(!1),f=r.useCallback(i=>{i===t.current&&o.current&&!o.current.paused?(o.current.pause(),b(!1)):i===o.current&&t.current&&!t.current.paused&&(t.current.pause(),p(!1))},[]),y=r.useCallback(()=>{t.current&&(f(t.current),n?t.current.pause():t.current.play().catch(i=>{console.warn("Autoplay bloqueado por el navegador (audio principal):",i)}),p(i=>!i))},[n,f]),o=r.useRef(null),[d,b]=r.useState(!1),k=r.useCallback(()=>{o.current&&(f(o.current),d?o.current.pause():o.current.play().catch(i=>{console.warn("Autoplay bloqueado por el navegador (audio alternativo):",i)}),b(i=>!i))},[d,f]);r.useEffect(()=>{if(x!=="true"||!S(m)||!U(g)){alert(e("actividad.accesoDenegado")),v("/EscanerQR");return}s&&G(Number(l))},[l,v,g,m,x,s,e]),r.useEffect(()=>()=>{t.current&&(t.current.pause(),p(!1)),o.current&&(o.current.pause(),b(!1))},[l]);const u=r.useCallback(i=>{if(!i)return"";const A=`/04-WebApp-Prehistoria/${i.startsWith("/")?i.substring(1):i}`;return console.log(`[DEBUG] URL de asset: ${A}`),A},[]);if(!s)return a.jsxs("div",{className:"actividad-container",style:{backgroundImage:`url("${u("assets/images/nogenially/error-default.jpeg")}")`,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"},children:[a.jsx("p",{className:"error-msg",children:e("actividad.errorActividadNoEncontrada")}),a.jsxs("button",{className:"btn-volver-mapa",onClick:()=>v("/"),children:[" ",e("actividad.volverInicio")]})]});if(!g||!m)return a.jsxs("div",{className:"actividad-container",style:{backgroundImage:`url("${u("assets/images/nogenially/acceso-denegado.jpeg")}")`,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"},children:[a.jsx("p",{className:"error-msg",children:e("actividad.accesoDenegado")}),a.jsx("button",{className:"btn-volver-mapa",onClick:()=>v("/"),children:e("actividad.volverInicio")})]});const E=u(s.imagenFondo||s.imagenAlternativa),I=u(`assets/avatars/${g}.png`),R=s.geniallyURL&&s.geniallyURL.trim()!==""&&s.geniallyURL!=="#",c=r.useMemo(()=>e(`${l}`,{returnObjects:!0}),[l,e]);return a.jsxs("div",{className:"actividad-container",style:{backgroundImage:`url("${E}")`,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"},children:[a.jsxs("div",{className:"saludo-titulo",children:[a.jsxs("div",{className:"titulo-mensaje",children:[a.jsx("h3",{children:c.titulo}),((j=c.avatarDialogo)==null?void 0:j.mensaje)&&c.avatarDialogo.mensaje!=="#"&&a.jsx("p",{children:c.avatarDialogo.mensaje})]}),a.jsxs("div",{className:"actividad-header",children:[a.jsx("img",{src:I,alt:e("altText.avatar"),className:"avatar-actividad"}),a.jsxs("div",{children:[a.jsx("h2",{className:"saludo1",children:e("actividad.saludo",{nombre:m})}),((h=c.avatarDialogo)==null?void 0:h.dialogo)&&a.jsx("p",{className:"dialogo",children:c.avatarDialogo.dialogo})]})]})]}),s.audio&&a.jsxs("div",{className:"audio-button-container",children:[a.jsxs("button",{onClick:y,className:`audio-button ${n?"playing":""}`,"aria-label":e(n?"actividad.pausarAudio":"actividad.reproducirAudio"),children:[a.jsx("i",{className:`fa-solid ${n?"fa-pause":"fa-play"}`})," ",e(n?"actividad.pausarAudio":"actividad.reproducirAudio")]}),a.jsx("audio",{ref:t,src:u(s.audio),preload:"auto",onEnded:()=>p(!1)}),s.audioENG&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:k,className:`audio-button-alt ${d?"playing":""}`,"aria-label":e(d?"actividad.pausarAudioENG":"actividad.reproducirAudioENG"),children:[a.jsx("i",{className:`fa-solid ${d?"fa-pause":"fa-play"}`})," ",e(d?"actividad.pausarAudioENG":"actividad.reproducirAudioENG")]}),a.jsx("audio",{ref:o,src:u(s.audioENG),preload:"auto",onEnded:()=>b(!1)})]})]}),((N=c.avatarDialogo)==null?void 0:N.sabiasQue)&&c.avatarDialogo.sabiasQue!=="#"&&a.jsxs("p",{className:"sabiasque",children:[a.jsx("strong",{children:e("actividad.sabiasQue")})," ",c.avatarDialogo.sabiasQue]}),R?a.jsx("div",{className:"actividad-genially",children:a.jsx("iframe",{src:s.geniallyURL,width:"100%",height:"clamp(300px, 70vh, 700px)",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,loading:"lazy"})}):a.jsx("div",{className:"actividad-siguiente"}),a.jsx("div",{className:"navigation-footer",children:a.jsxs("button",{className:"btn-volver",onClick:()=>v("/entre-actividad"),children:[a.jsx("i",{className:"fa-solid fa-map-location-dot"})," ",e("actividad.verMapaActividad")]})})]})}export{L as default};
